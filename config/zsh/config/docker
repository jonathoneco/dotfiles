#!/usr/bin/env bash
#------------------------------------------------------------------------------
# Docker Specific Aliases
#------------------------------------------------------------------------------

# Basic Docker Commands
alias dps='docker ps -a'      # List all containers (running and stopped)
alias dpss='docker ps -a --format "table {{.Names}}\t{{.State}}\t{{.Status}}\t{{.Image}}" | (sed -u 1q; sort)'      # List containers in a nicely formatted table
alias ddf='docker system df'      # Show Docker disk usage for containers, images, and volumes
alias dexec='docker exec -ti'      # Execute command in running container (interactive mode)

# Docker Logs and Monitoring
alias dlogs='docker logs -tf --tail="50" '      # Show last 50 lines of container logs and follow output
alias dlogsize='du -ch $(docker inspect --format="{{.LogPath}}" $(docker ps -qa)) | sort -h'      # Display size of container log files
alias dips="docker ps -q | xargs -n 1 docker inspect -f '{{.Name}}\t{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' | sed 's#/##g' | sort | column -t"      # List IP addresses of all containers

# Docker Container Management
alias dstop='docker stop'      # Stop a specific container
alias dstopall='docker stop $(docker ps -aq)'      # Stop all running containers
alias drm='docker rm $(docker ps -a -q)'      # Remove specified containers

# Docker Cleanup and Maintenance
alias dprunevol='docker volume prune'      # Remove all unused volumes
alias dprunesys='docker system prune -a'      # Remove all unused containers, networks, images (both dangling and unreferenced)
alias ddelimages='docker rmi $(docker images -q)'      # Delete all Docker images

alias derase='dstopall ; drm ; ddelimages ; dprunevol ; dprunesys'
alias dprune='ddelimages ; dprunevol ; dprunesys'

# Docker Compose Basic Commands
alias dcrun='sudo docker compose --profile all -f $DOCKER_FOLDER/docker-compose-$REMOTE_HOSTNAME.yml'      # Base command for docker-compose operations
alias dcup='dcrun up -d --build --remove-orphans'      # Start all services, rebuild if needed, remove orphaned containers
alias dcdown='dcrun down --remove-orphans'      # Stop and remove all containers, including orphaned ones
alias dcstop='dcrun stop'      # Stop services without removing containers
alias dcstart='dcrun start'      # Start existing containers
alias dcrestart='dcrun restart'      # Restart services
alias dcrec='dcrun up -d --force-recreate --remove-orphans'      # Force recreate containers even if no changes
alias dcpull='dcrun pull'      # Pull latest versions of all service images
alias dclogs='dcrun logs -tf --tail="50"'      # Show and follow last 50 lines of service logs

# Traefik Specific
alias traefiklogs='tail -f $DOCKER_FOLDER/logs/$REMOTE_HOSTNAME/traefik/traefik.log'      # Monitor Traefik reverse proxy logs

# CrowdSec CLI Commands
alias cscli='dcrun exec -t crowdsec cscli'      # Execute CrowdSec CLI commands
alias csdecisions='cscli decisions list'      # List current IP ban decisions
alias csalerts='cscli alerts list'      # List security alerts
alias csinspect='cscli alerts inspect -d'      # Detailed inspection of specific alerts
alias cshubs='cscli hub list'      # List available CrowdSec hubs
alias csparsers='cscli parsers list'      # List installed parsers
alias cscollections='cscli collections list'      # List installed collections
alias cshubupdate='cscli hub update'      # Update CrowdSec hub index
alias cshubupgrade='cscli hub upgrade'      # Upgrade all hub items
alias csmetrics='cscli metrics'      # Show CrowdSec metrics
alias csmachines='cscli machines list'      # List CrowdSec machines
alias csbouncers='cscli bouncers list'      # List registered bouncers

# CrowdSec Service Management (systemctl is Linux-specific)
alias csfbstatus='sudo launchctl list | grep crowdsec-firewall-bouncer'
alias csfbstart='sudo launchctl start crowdsec-firewall-bouncer'
alias csfbstop='sudo launchctl stop crowdsec-firewall-bouncer'
alias csfbrestart='sudo launchctl kickstart -k system/crowdsec-firewall-bouncer'
alias csbrestart='dcrec2 traefik-bouncer ; csfbrestart'

# CrowdSec Logs
alias tailkern='sudo tail -f /var/log/kern.log'      # Monitor kernel logs
alias tailauth='sudo tail -f /var/log/auth.log'      # Monitor authentication logs
alias tailcsfb='tail -f /var/log/crowdsec-firewall-bouncer.log'      # Monitor firewall bouncer logs

