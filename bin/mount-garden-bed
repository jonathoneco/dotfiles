#!/bin/bash

# SSHFS mount script for garden-bed server

MOUNT_POINT="$HOME/mnt/garden-bed"
REMOTE_HOST="jonco@garden-bed"
REMOTE_PORT="3212"
REMOTE_DIR="/home/jonco/src/garden-bed"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# Check if already mounted
if mountpoint -q "$MOUNT_POINT"; then
    echo -e "${YELLOW}Already mounted at $MOUNT_POINT${NC}"
    exit 0
fi

# Mount the remote directory
echo -e "${YELLOW}Mounting $REMOTE_HOST:$REMOTE_DIR to $MOUNT_POINT...${NC}"

sshfs -p $REMOTE_PORT \
    -o reconnect \
    -o ServerAliveInterval=15 \
    -o ServerAliveCountMax=3 \
    -o follow_symlinks \
    -o cache=yes \
    -o kernel_cache \
    -o compression=no \
    "$REMOTE_HOST:$REMOTE_DIR" \
    "$MOUNT_POINT"

if [ $? -eq 0 ]; then
    echo -e "${GREEN}✓ Successfully mounted!${NC}"
    echo -e "You can now work in: $MOUNT_POINT"
    tmux-sessionizer $MOUNT_POINT
else
    echo -e "${RED}✗ Mount failed!${NC}"
    exit 1
fi
