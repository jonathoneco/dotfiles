#!/bin/bash

# Check if external monitors are connected (anything other than eDP-1)
external_output=$(swaymsg -t get_outputs | jq -r '.[] | select(.name != "eDP-1" and .active) | .name' | head -1)

if [ "$1" = "close" ]; then
    # Only disable internal display if external monitors are present
    if [ -n "$external_output" ]; then
        # Move all workspaces from eDP-1 to an external monitor before disabling
        for ws in $(swaymsg -t get_workspaces | jq -r '.[] | select(.output == "eDP-1") | .name'); do
            swaymsg "[workspace=$ws]" move workspace to output "$external_output"
        done
        swaymsg output eDP-1 disable
    fi
    # If no external monitors, do nothing - let system handle suspend
else
    # Lid is opening - always enable internal display
    swaymsg output eDP-1 enable resolution 3840x2400 position 0 1440 scale 1.5
fi
